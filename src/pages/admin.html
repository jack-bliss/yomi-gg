<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin</title>
    <style>
        .highlighted {
            background-color: aqua;
        }
        #match_container div {
            padding: 10px;
            border-bottom: 1px solid aliceblue;
        }
    </style>
</head>
<body>

<form action="/smashgg/import/" method="post">

    <input type="text" name="tournament" placeholder="tournament slug" /><br />
    <input type="text" name="group_id" placeholder="group id" /><br />
    <input type="submit" value="Submit" />

</form>

<form id="get_matches">

    <label for="tournament_list">Tournaments</label>
    <select name="tournament" id="tournament_list">

    </select><br />
    <input type="submit" value="Load" />

</form>

<div id="match_container">

</div>

<script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

<script>

$(() => {

    $.ajax({
      url: '/events',
      dataType: 'JSON',
      success: (events) => {
        events.forEach(e => {
          $("#tournament_list").append(
            $("<option />").val(e.id).text(e.name)
          );
        });
      }
    });

    $("#get_matches").submit(e => {
      e.preventDefault();
      const id = $("#tournament_list").val();
      $.ajax({
        url: '/events/' + id + '/matches',
        dataType: 'JSON',
        success: (matches) => {
          matches.forEach(m => {
            $("#match_container").append(
              $("<div />")
                .addClass(() => m.highlight > 0 ? 'highlighted' : null)
                .append(
                  $("<span />")
                    .text(m.entrant1tag + ' v ' + m.entrant2tag + ', ' + m.round)
                )
                .append(
                  $("<button />")
                    .text('Highlight')
                    .attr('data-id', m.id)
                    .addClass('highlight')
                )
            );
          });
        }
      })
    });

    $("#match_container").on('click', '.highlight', e => {
      const $clicked = $(e.target);
      const $row = $clicked.parent();
      $.ajax({
        url: '/matches/highlight/',
        method: 'post',
        data: {
          id: $click.attr('data-id'),
          level: $row.hasClass('highlighted') ? 0 : 1,
        },
        dataType: 'JSON',
        success: (match) => {
          if (match.highlight === 0) {
            $row.removeClass('highlighted');
          } else {
            $row.addClass('highlighted');
          }
        }
      })
    });



});

</script>

</body>
</html>